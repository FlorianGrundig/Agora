extends ../../../views/layout
include ../../../views/formComponents

block scripts
  script(type="text/javascript", src="https://js.stripe.com/v2/")
  script.
    Stripe.setPublishableKey('#{paymentKey}');
    $(document).ready(function() {
      $("#charge-error").hide()
      $('#paymentform').submit(function(event) {
        $("#charge-error").hide()
        var $form = $(this);
        // Disable the submit button to prevent repeated clicks
        $form.find('button').prop('disabled', true);
        Stripe.card.createToken($form, stripeResponseHandler);
        // Prevent the form from submitting with the default action
        return false;
        });
    });
    function stripeResponseHandler(status, response) {
      if (response.error) {
        // show the errors on the form
        $("#charge-error").show()
        $("#charge-error").text(response.error.message);
        $(".submit-button").removeAttr("disabled");
      } else {
        var form$ = $("#paymentform");
        // token contains id, last4, and card type
        var token = response['id'];
        // insert the token into the form so it gets submitted to the server
        form$.append("<input type='hidden' name='stripeToken' value='" + token + "'/>");
        form$.append("<input type='hidden' name='response' value='" + JSON.stringify(response) + "'/>");
        // and submit
        form$.get(0).submit();
      }
    }

block title
  | #{t("payment.title")}

block content
  #charge-error.alert.alert-danger
  h2 #{activity.title()} - #{t("payment.title")}
    br
    small Wähle, wie Du bezahlen möchtest.
  .row
    .col-md-12
      p.
        Die Veranstaltung erfordert, dass Du vorab eine Zahlung leistest. Bitte entscheide Dich, wie Du die Zahlung
        leisten möchtest. Du kannst das Geld entweder überweisen oder gegen Gebühr mit Kreditkarte bezahlen.
  .row
    .col-md-6
      form.form-horizontal(action='/activities/payment/submitTransfer', method='post')
        +csrf
        +hidden('url', activity.url())
        legend Überweisung
        .form-group
          label.col-sm-4.control-label #{t("payment.amount")}:
          .col-sm-8
            p.form-control-static 150 EUR
        .form-group
          label.col-sm-4.control-label #{t("payment.bic")}:
          .col-sm-8
            p.form-control-static BIC here
        .form-group
          label.col-sm-4.control-label #{t("payment.iban")}:
          .col-sm-8
            p.form-control-static IBAN here
        .form-group
          label.col-sm-4.control-label #{t("payment.receiver")}:
          .col-sm-8
            p.form-control-static Nicole Rauch
        button.btn.btn-primary.pull-right(type="submit") #{t("payment.transferred")}
        
    .col-md-6
      legend Kreditkarte
      form#paymentform(action='/activities/payment/submitCreditCard', method='post')
        +csrf
        +hidden('url', activity.url())
        fieldset
          .form-group
            label.control-label(for="cardnumber") Kartennummer:
            input.form-control(type='text', autocomplete='off', data-stripe='number', placeholder='Card Number')
          .form-group
            label.control-label(for="cvc") Prüfziffer:
            input.form-control(type='text', autocomplete='off', data-stripe='cvc', placeholder='CVC Code')
          .form-group
            label.control-label(for="month") Gültig bis Monat:
            input.form-control(type='text', data-stripe='exp-month', placeholder='MM')
          .form-group
            label.control-label(for="year") Gültig bis Jahr:
            input.form-control(type='text', data-stripe='exp-year', placeholder='YYYY')
          button.btn.btn-primary.submit-button.pull-right(type="submit") #{t("general.save")}

